<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tab Issue Debug</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        
        .debug-section {
            background: #333;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
        }
        
        .debug-section h3 {
            margin-top: 0;
            color: #007acc;
        }
        
        .test-button {
            background: #007acc;
            color: white;
            border: none;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .test-button:hover {
            background: #0056b3;
        }
        
        .log-output {
            background: #222;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin: 10px 0;
        }
        
        .success { color: #51cf66; }
        .error { color: #ff6b6b; }
        .warning { color: #ffd43b; }
        .info { color: #74c0fc; }
    </style>
</head>
<body>
    <h1>Tab Switching Issue Debug</h1>
    
    <div class="debug-section">
        <h3>1. Test Basic Click Events</h3>
        <button class="test-button" onclick="testBasicClick()">Test Basic Click</button>
        <button class="test-button" onclick="testElementSelection()">Test Element Selection</button>
        <button class="test-button" onclick="testEventListeners()">Test Event Listeners</button>
        <div id="basic-click-output" class="log-output"></div>
    </div>
    
    <div class="debug-section">
        <h3>2. Test FlutterEarth Instance</h3>
        <button class="test-button" onclick="testFlutterEarth()">Test FlutterEarth Instance</button>
        <button class="test-button" onclick="testSwitchView()">Test switchView Function</button>
        <div id="flutterearth-output" class="log-output"></div>
    </div>
    
    <div class="debug-section">
        <h3>3. Test CSS and Display</h3>
        <button class="test-button" onclick="testCSS()">Test CSS Rules</button>
        <button class="test-button" onclick="testViewElements()">Test View Elements</button>
        <div id="css-output" class="log-output"></div>
    </div>
    
    <div class="debug-section">
        <h3>4. Test Toolbar Items</h3>
        <button class="test-button" onclick="testToolbarItems()">Test Toolbar Items</button>
        <button class="test-button" onclick="testToolbarClick()">Test Toolbar Click</button>
        <div id="toolbar-output" class="log-output"></div>
    </div>
    
    <div class="debug-section">
        <h3>5. Manual Tab Switch Test</h3>
        <button class="test-button" onclick="manualSwitch('welcome')">Switch to Welcome</button>
        <button class="test-button" onclick="manualSwitch('map')">Switch to Map</button>
        <button class="test-button" onclick="manualSwitch('download')">Switch to Download</button>
        <div id="manual-output" class="log-output"></div>
    </div>
    
    <script>
        function log(message, type = 'info', outputId = 'basic-click-output') {
            const output = document.getElementById(outputId);
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : 'info';
            const div = document.createElement('div');
            div.className = className;
            div.textContent = `[${timestamp}] ${message}`;
            output.appendChild(div);
            output.scrollTop = output.scrollHeight;
            console.log(`[${timestamp}] ${message}`);
        }
        
        function testBasicClick() {
            log('Testing basic click functionality...', 'info', 'basic-click-output');
            log('If you see this, basic JavaScript is working', 'success', 'basic-click-output');
        }
        
        function testElementSelection() {
            log('Testing element selection...', 'info', 'basic-click-output');
            
            const toolbarItems = document.querySelectorAll('.toolbar-item');
            log(`Found ${toolbarItems.length} toolbar items`, toolbarItems.length > 0 ? 'success' : 'error', 'basic-click-output');
            
            const viewElements = document.querySelectorAll('.view-content');
            log(`Found ${viewElements.length} view elements`, viewElements.length > 0 ? 'success' : 'error', 'basic-click-output');
            
            if (toolbarItems.length === 0) {
                log('ERROR: No toolbar items found! This is the problem.', 'error', 'basic-click-output');
            }
        }
        
        function testEventListeners() {
            log('Testing event listener setup...', 'info', 'basic-click-output');
            
            const testElement = document.createElement('div');
            testElement.textContent = 'Test Element';
            testElement.style.padding = '10px';
            testElement.style.background = '#555';
            testElement.style.margin = '5px';
            testElement.style.cursor = 'pointer';
            
            let clickCount = 0;
            testElement.addEventListener('click', () => {
                clickCount++;
                log(`Test element clicked ${clickCount} times`, 'success', 'basic-click-output');
            });
            
            document.body.appendChild(testElement);
            log('Test element added. Click it to test event listeners.', 'info', 'basic-click-output');
        }
        
        function testFlutterEarth() {
            log('Testing FlutterEarth instance...', 'info', 'flutterearth-output');
            
            if (window.flutterEarth) {
                log('FlutterEarth instance found', 'success', 'flutterearth-output');
                log(`FlutterEarth type: ${typeof window.flutterEarth}`, 'info', 'flutterearth-output');
                log(`FlutterEarth constructor: ${window.flutterEarth.constructor.name}`, 'info', 'flutterearth-output');
                
                if (typeof window.flutterEarth.switchView === 'function') {
                    log('switchView function exists', 'success', 'flutterearth-output');
                } else {
                    log('ERROR: switchView function not found!', 'error', 'flutterearth-output');
                }
            } else {
                log('ERROR: FlutterEarth instance not found!', 'error', 'flutterearth-output');
                log('This means the main JavaScript file is not loading properly', 'error', 'flutterearth-output');
            }
        }
        
        function testSwitchView() {
            log('Testing switchView function...', 'info', 'flutterearth-output');
            
            if (window.flutterEarth && typeof window.flutterEarth.switchView === 'function') {
                try {
                    log('Calling switchView("map")...', 'info', 'flutterearth-output');
                    window.flutterEarth.switchView('map');
                    log('switchView called successfully', 'success', 'flutterearth-output');
                    
                    setTimeout(() => {
                        const mapView = document.getElementById('map-view');
                        if (mapView) {
                            const isActive = mapView.classList.contains('active');
                            const display = getComputedStyle(mapView).display;
                            log(`Map view active: ${isActive}, display: ${display}`, 'info', 'flutterearth-output');
                        } else {
                            log('ERROR: map-view element not found', 'error', 'flutterearth-output');
                        }
                    }, 100);
                } catch (error) {
                    log(`ERROR in switchView: ${error.message}`, 'error', 'flutterearth-output');
                }
            } else {
                log('ERROR: Cannot test switchView - function not available', 'error', 'flutterearth-output');
            }
        }
        
        function testCSS() {
            log('Testing CSS rules...', 'info', 'css-output');
            
            const testView = document.getElementById('welcome-view');
            if (testView) {
                const computedStyle = getComputedStyle(testView);
                log(`Welcome view display: ${computedStyle.display}`, 'info', 'css-output');
                log(`Welcome view visibility: ${computedStyle.visibility}`, 'info', 'css-output');
                log(`Welcome view opacity: ${computedStyle.opacity}`, 'info', 'css-output');
                log(`Welcome view position: ${computedStyle.position}`, 'info', 'css-output');
                log(`Welcome view z-index: ${computedStyle.zIndex}`, 'info', 'css-output');
            } else {
                log('ERROR: welcome-view element not found', 'error', 'css-output');
            }
        }
        
        function testViewElements() {
            log('Testing view elements...', 'info', 'css-output');
            
            const viewElements = document.querySelectorAll('.view-content');
            viewElements.forEach((view, index) => {
                const id = view.id;
                const isActive = view.classList.contains('active');
                const display = getComputedStyle(view).display;
                log(`View ${index}: id="${id}", active=${isActive}, display="${display}"`, 'info', 'css-output');
            });
        }
        
        function testToolbarItems() {
            log('Testing toolbar items...', 'info', 'toolbar-output');
            
            const toolbarItems = document.querySelectorAll('.toolbar-item');
            toolbarItems.forEach((item, index) => {
                const view = item.dataset.view;
                const panel = item.dataset.panel;
                const isActive = item.classList.contains('active');
                const cursor = getComputedStyle(item).cursor;
                const pointerEvents = getComputedStyle(item).pointerEvents;
                
                log(`Toolbar ${index}: view="${view}", panel="${panel}", active=${isActive}, cursor="${cursor}", pointer-events="${pointerEvents}"`, 'info', 'toolbar-output');
            });
        }
        
        function testToolbarClick() {
            log('Testing toolbar click simulation...', 'info', 'toolbar-output');
            
            const toolbarItems = document.querySelectorAll('.toolbar-item');
            if (toolbarItems.length > 0) {
                const firstItem = toolbarItems[0];
                const view = firstItem.dataset.view;
                
                log(`Simulating click on first toolbar item (${view})...`, 'info', 'toolbar-output');
                
                // Create and dispatch a click event
                const clickEvent = new MouseEvent('click', {
                    bubbles: true,
                    cancelable: true,
                    view: window
                });
                
                firstItem.dispatchEvent(clickEvent);
                log('Click event dispatched', 'success', 'toolbar-output');
                
                setTimeout(() => {
                    const activeView = document.querySelector('.view-content.active');
                    log(`Active view after click: ${activeView ? activeView.id : 'none'}`, 'info', 'toolbar-output');
                }, 100);
            } else {
                log('ERROR: No toolbar items found to test', 'error', 'toolbar-output');
            }
        }
        
        function manualSwitch(viewName) {
            log(`Manual switch to: ${viewName}`, 'info', 'manual-output');
            
            if (window.flutterEarth && typeof window.flutterEarth.switchView === 'function') {
                try {
                    window.flutterEarth.switchView(viewName);
                    log(`Successfully called switchView("${viewName}")`, 'success', 'manual-output');
                    
                    setTimeout(() => {
                        const targetView = document.getElementById(`${viewName}-view`);
                        if (targetView) {
                            const isActive = targetView.classList.contains('active');
                            const display = getComputedStyle(targetView).display;
                            log(`Target view active: ${isActive}, display: ${display}`, 'info', 'manual-output');
                        } else {
                            log(`ERROR: ${viewName}-view element not found`, 'error', 'manual-output');
                        }
                    }, 100);
                } catch (error) {
                    log(`ERROR in manual switch: ${error.message}`, 'error', 'manual-output');
                }
            } else {
                log('ERROR: FlutterEarth or switchView not available', 'error', 'manual-output');
            }
        }
        
        // Auto-run some tests on page load
        window.addEventListener('load', () => {
            log('Page loaded, running initial tests...', 'info', 'basic-click-output');
            setTimeout(() => {
                testElementSelection();
                testFlutterEarth();
            }, 1000);
        });
    </script>
</body>
</html> 