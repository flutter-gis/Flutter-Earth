<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tab Switching Test - Fixed</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        
        .toolbar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            padding: 10px;
            background: #333;
            border-radius: 8px;
        }
        
        .toolbar-item {
            padding: 10px 15px;
            background: #555;
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .toolbar-item:hover {
            background: #777;
        }
        
        .toolbar-item.active {
            background: #007acc;
        }
        
        .view-content {
            display: none !important;
            padding: 20px;
            background: #2a2a2a;
            border-radius: 8px;
            min-height: 200px;
            position: relative;
            z-index: 1;
        }
        
        .view-content.active {
            display: block !important;
            opacity: 1 !important;
            transform: none !important;
            visibility: visible !important;
        }
        
        .test-result {
            background: #333;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-family: monospace;
            font-size: 12px;
        }
        
        .test-result h3 {
            margin-top: 0;
            color: #007acc;
        }
        
        .test-item {
            margin: 5px 0;
            padding: 5px;
            background: #444;
            border-radius: 3px;
        }
        
        .success {
            color: #51cf66;
        }
        
        .error {
            color: #ff6b6b;
        }
        
        .info {
            color: #74c0fc;
        }
    </style>
</head>
<body>
    <h1>Tab Switching Test - Fixed Version</h1>
    
    <div class="toolbar">
        <div class="toolbar-item active" data-view="welcome">üè† Home</div>
        <div class="toolbar-item" data-view="map">üó∫Ô∏è Map</div>
        <div class="toolbar-item" data-view="download">üì• Download</div>
        <div class="toolbar-item" data-view="satelliteInfo">üõ∞Ô∏è Satellite Info</div>
        <div class="toolbar-item" data-view="settings">‚öôÔ∏è Settings</div>
        <div class="toolbar-item" data-view="about">‚ÑπÔ∏è About</div>
    </div>
    
    <div id="welcome-view" class="view-content active">
        <h2>Welcome View</h2>
        <p>This is the welcome view. If you can see this, the tab system is working!</p>
        <p>Click on any tab above to test the switching functionality.</p>
    </div>
    
    <div id="map-view" class="view-content">
        <h2>Map View</h2>
        <p>This is the map view.</p>
        <p>‚úÖ Tab switching is working if you can see this!</p>
    </div>
    
    <div id="download-view" class="view-content">
        <h2>Download View</h2>
        <p>This is the download view.</p>
        <p>‚úÖ Tab switching is working if you can see this!</p>
    </div>
    
    <div id="satelliteInfo-view" class="view-content">
        <h2>Satellite Info View</h2>
        <p>This is the satellite info view.</p>
        <p>‚úÖ Tab switching is working if you can see this!</p>
    </div>
    
    <div id="settings-view" class="view-content">
        <h2>Settings View</h2>
        <p>This is the settings view.</p>
        <p>‚úÖ Tab switching is working if you can see this!</p>
    </div>
    
    <div id="about-view" class="view-content">
        <h2>About View</h2>
        <p>This is the about view.</p>
        <p>‚úÖ Tab switching is working if you can see this!</p>
    </div>
    
    <div class="test-result">
        <h3>Test Results</h3>
        <div id="test-output"></div>
    </div>
    
    <script>
        class TabTest {
            constructor() {
                this.currentView = 'welcome';
                this.testOutput = document.getElementById('test-output');
                this.init();
            }
            
            log(message, type = 'info') {
                const timestamp = new Date().toLocaleTimeString();
                const className = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
                const div = document.createElement('div');
                div.className = `test-item ${className}`;
                div.textContent = `[${timestamp}] ${message}`;
                this.testOutput.appendChild(div);
                this.testOutput.scrollTop = this.testOutput.scrollHeight;
                console.log(`[${timestamp}] ${message}`);
            }
            
            init() {
                this.log('Initializing TabTest...', 'info');
                
                // Check if DOM is ready
                if (document.readyState === 'loading') {
                    this.log('DOM still loading, waiting...', 'info');
                    document.addEventListener('DOMContentLoaded', () => this.setupEventListeners());
                } else {
                    this.log('DOM already loaded, setting up listeners immediately', 'success');
                    this.setupEventListeners();
                }
                
                // Log initial state
                this.logInitialState();
            }
            
            logInitialState() {
                this.log('=== INITIAL STATE CHECK ===', 'info');
                
                // Check toolbar items
                const toolbarItems = document.querySelectorAll('.toolbar-item');
                this.log(`Found ${toolbarItems.length} toolbar items`, toolbarItems.length > 0 ? 'success' : 'error');
                
                toolbarItems.forEach((item, index) => {
                    const view = item.dataset.view;
                    const isActive = item.classList.contains('active');
                    this.log(`Toolbar item ${index}: view="${view}", active=${isActive}`, 'info');
                });
                
                // Check view elements
                const viewElements = document.querySelectorAll('.view-content');
                this.log(`Found ${viewElements.length} view elements`, viewElements.length > 0 ? 'success' : 'error');
                
                viewElements.forEach((view, index) => {
                    const id = view.id;
                    const isActive = view.classList.contains('active');
                    const display = getComputedStyle(view).display;
                    this.log(`View ${index}: id="${id}", active=${isActive}, display="${display}"`, 'info');
                });
                
                this.log('=== END INITIAL STATE ===', 'info');
            }
            
            setupEventListeners() {
                this.log('Setting up event listeners...', 'info');
                
                const toolbarItems = document.querySelectorAll('.toolbar-item');
                this.log(`Setting up listeners for ${toolbarItems.length} toolbar items`, 'info');
                
                if (toolbarItems.length === 0) {
                    this.log('No toolbar items found! Check HTML structure.', 'error');
                    return;
                }
                
                toolbarItems.forEach((item, index) => {
                    const view = item.dataset.view;
                    this.log(`Adding click listener to toolbar item ${index} (${view})`, 'info');
                    
                    // Remove any existing listeners to prevent duplicates
                    item.removeEventListener('click', item._clickHandler);
                    
                    // Create new click handler
                    item._clickHandler = (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        
                        this.log(`Toolbar item clicked: ${view}`, 'success');
                        this.switchView(view);
                    };
                    
                    item.addEventListener('click', item._clickHandler);
                });
                
                this.log('Event listeners setup complete', 'success');
            }
            
            switchView(viewName) {
                this.log(`Switching to view: ${viewName}`, 'info');
                
                try {
                    // Validate view name
                    if (!viewName) {
                        this.log('No view name provided', 'error');
                        return;
                    }
                    
                    // Hide all views
                    const allViews = document.querySelectorAll('.view-content');
                    this.log(`Found ${allViews.length} view elements to hide`, 'info');
                    
                    allViews.forEach(view => {
                        view.classList.remove('active');
                        view.style.display = 'none';
                        view.style.opacity = '0';
                        view.style.transform = 'translateY(20px)';
                        this.log(`Hidden view: ${view.id}`, 'info');
                    });
                    
                    // Show selected view
                    const targetView = document.getElementById(`${viewName}-view`);
                    this.log(`Looking for view: ${viewName}-view, found: ${targetView ? 'YES' : 'NO'}`, targetView ? 'success' : 'error');
                    
                    if (targetView) {
                        targetView.style.display = 'block';
                        targetView.style.opacity = '1';
                        targetView.style.transform = 'translateY(0)';
                        targetView.classList.add('active');
                        this.log(`Successfully switched to ${viewName}-view`, 'success');
                        
                        // Log computed styles
                        const computedStyle = getComputedStyle(targetView);
                        this.log(`View computed styles: display="${computedStyle.display}", opacity="${computedStyle.opacity}"`, 'info');
                    } else {
                        this.log(`View not found: ${viewName}-view`, 'error');
                        // Fallback to welcome view
                        const fallback = document.getElementById('welcome-view');
                        if (fallback) {
                            fallback.style.display = 'block';
                            fallback.style.opacity = '1';
                            fallback.style.transform = 'translateY(0)';
                            fallback.classList.add('active');
                            this.log('Fallback to welcome-view', 'info');
                            viewName = 'welcome';
                        } else {
                            this.log('Even welcome view not found!', 'error');
                            return;
                        }
                    }
                    
                    // Update toolbar active state
                    document.querySelectorAll('.toolbar-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    
                    const activeToolbarItem = document.querySelector(`.toolbar-item[data-view="${viewName}"]`);
                    if (activeToolbarItem) {
                        activeToolbarItem.classList.add('active');
                        this.log(`Set toolbar item active: ${viewName}`, 'success');
                    } else {
                        this.log(`Toolbar item not found for view: ${viewName}`, 'error');
                    }
                    
                    // Update current view tracking
                    this.currentView = viewName;
                    this.log(`Current view updated to: ${viewName}`, 'success');
                    
                } catch (error) {
                    this.log(`Error in switchView: ${error.message}`, 'error');
                    console.error('Error in switchView:', error);
                }
            }
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            window.tabTest = new TabTest();
        });
        
        // Also try immediate initialization
        if (document.readyState !== 'loading') {
            window.tabTest = new TabTest();
        }
    </script>
</body>
</html> 